<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fishy Chat</title>
<link rel="icon" href="image.png">
<style>
body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
#messages { border: 1px solid #ccc; padding: 10px; max-height: 400px; overflow-y: auto; margin-bottom: 10px; }
.message { border-bottom: 1px solid #eee; padding: 5px; }
.message img { max-width: 150px; display: block; margin-top: 5px; }
input { margin: 5px; padding: 5px; }
button { padding: 5px 10px; }
</style>
</head>
<body>

<h1 id="chatTitle" style="font-size: 80px; font-family: cursive;"><img src="image.png" alt="Fish Chat" style="width: 220px; height: 170px;"> Fishy Chat :)</h1>
<div id="messages"></div>

<input type="text" id="title" placeholder="Name" style="width: 200px;">
<input type="text" id="text" placeholder="Message" style="width: 300px;">
<input type="text" id="image" placeholder="Image URL" style="width: 200px;">
<button id="sendBtn">Send</button>
<button id="newChatBtn">Start New Room</button>
<a id="chatLink" href="#" target="_blank"></a>

<script>
function generateID(length = 12) {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    let id = '';
    for (let i = 0; i < length; i++) {
        id += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return id;
}

// Get chat ID from hash
let chatID = location.hash.slice(1);
if (!chatID) {
    chatID = generateID();
    location.hash = chatID;
}

// Set chat link
const link = document.getElementById('chatLink');
link.href = `#${chatID}`;
link.textContent = `${link.href}`;

// Load messages
const messagesDiv = document.getElementById('messages');

function loadMessages() {
    const messages = JSON.parse(localStorage.getItem(chatID) || '[]');
    messagesDiv.innerHTML = '';
    messages.forEach(msg => {
        const div = document.createElement('div');
        div.className = 'message';
        div.innerHTML = `<strong>${msg.title}</strong><br>${msg.text}`;
        if (msg.image) {
            const img = document.createElement('img');
            img.src = msg.image;
            div.appendChild(img);
        }
        messagesDiv.appendChild(div);
    });
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

document.getElementById('sendBtn').addEventListener('click', () => {
    const title = document.getElementById('title').value.trim();
    const text = document.getElementById('text').value.trim();
    const image = document.getElementById('image').value.trim();
    if (!text && !image) return;

    const messages = JSON.parse(localStorage.getItem(chatID) || '[]');
    messages.push({ title, text, image });
    localStorage.setItem(chatID, JSON.stringify(messages));

    document.getElementById('title').value = '';
    document.getElementById('text').value = '';
    document.getElementById('image').value = '';
    loadMessages();
});

document.getElementById('newChatBtn').addEventListener('click', () => {
    chatID = generateID();
    location.hash = chatID;
    localStorage.setItem(chatID, JSON.stringify([]));
    loadMessages();
    link.href = `#${chatID}`;
    link.textContent = `This chat link: ${link.href}`;
});

setInterval(loadMessages, 2000);

loadMessages();
</script>
</body>
</html>
